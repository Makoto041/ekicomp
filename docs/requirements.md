# 駅コンプリートアプリ「EKICOMP」要件定義書

## 1. プロジェクト概要

### 1.1 プロダクト名（仮）
**EKICOMP** — 東京都内の全駅を巡ってコンプリートを目指すWebアプリ

### 1.2 コンセプト
「行ったことない駅に降りて、街を歩いて、居酒屋に入る」——そんな日常の冒険を記録し、可視化し、共有できるアプリ。駅巡りデートや一人散歩をもっと楽しくする。

### 1.3 ターゲットユーザー
- 東京在住で「行ったことない駅」を開拓したい人
- カップルで駅巡りデートを楽しみたい人
- コンプリート欲・収集欲がある人
- 将来的に一般公開を目指す

### 1.4 開発の動機
- Kotlinの学習
- AI頼みではなく、自分の手でコードを理解しながら作る
- まず最小構成で動くものを作り、段階的に育てる

---

## 2. 機能要件

### 2.1 認証機能
- Google ソーシャルログイン
- Apple ソーシャルログイン
- ユーザープロフィール（ニックネーム、アイコン）

### 2.2 駅データ管理
- 東京都内の全路線・全駅のマスターデータ
  - JR、東京メトロ、都営地下鉄、私鉄（東急・小田急・京王・西武・東武・京急・京成・つくばエクスプレス等）
  - モノレール、ゆりかもめ、都電荒川線 等
- 各駅の緯度・経度情報
- 路線ごとのグルーピング

### 2.3 チェックイン機能（複数方式）

#### a) GPS自動チェックイン
- 駅の近く（半径200m目安）に来たらプッシュ通知
- ユーザーがタップして訪問を記録
- バックグラウンドでの位置情報取得（PWAの制約を考慮）

#### b) 手動検索チェックイン
- 駅名をテキスト検索して選択→チェックイン
- 路線から辿って駅を選択→チェックイン

#### c) 地図タップチェックイン
- 地図上に駅のピンを表示
- ピンをタップしてチェックイン

#### 共通記録項目
- 訪問日時（自動記録＋手動編集可）
- メモ（テキスト自由記述）
- 写真（複数枚アップロード可）

### 2.4 スポット記録機能
- 駅に紐づけて「行った場所」を記録
  - 居酒屋、カフェ、ラーメン屋、公園 等
- 各スポットに対して：名前、カテゴリ、メモ、写真、評価（★1〜5）

### 2.5 地図可視化
- 東京都内の地図上に全駅をピン表示
- 訪問済み：カラー表示 / 未訪問：グレー表示
- タップで駅の詳細（訪問日、メモ、写真、スポット）を表示
- 路線別にフィルタリング可能

### 2.6 進捗・統計
- 全体の達成率（◯◯ / 全◯◯駅）
- 路線ごとの達成率とプログレスバー
- 月別・週別の訪問数グラフ
- 連続訪問日数（ストリーク）
- 最近訪問した駅の一覧

### 2.7 バッジ・実績解除
- 条件を満たすとバッジを獲得
- バッジ例：
  - 「はじめの一歩」：初チェックイン
  - 「山手線マスター」：山手線全駅制覇
  - 「◯◯線コンプリート」：各路線全駅制覇
  - 「居酒屋ハンター」：10軒の居酒屋を記録
  - 「週末冒険家」：土日に5駅以上チェックイン
  - 「100駅突破」「200駅突破」...
  - 「デート記録」：2人で同じ駅にチェックイン（将来）

### 2.8 ランダム駅提案
- 「次どこ行く？」ボタンで未訪問の駅をランダム提案
- フィルタ条件：路線指定、エリア指定、現在地から◯分以内
- 提案された駅の周辺情報（飲食店等）へのリンク

### 2.9 ソーシャル機能
- フレンド追加（招待リンク or ユーザーID検索）
- フレンドの達成率・最近の訪問が見える
- ランキング（総訪問駅数、月間訪問数）
- 訪問記録のシェア（SNS共有用の画像生成）

### 2.10 彼女との共有機能（将来検討）
- 共有マップ：2人の訪問を重ねて表示
- ペアバッジ：2人で一緒に達成するバッジ
- 共通の思い出タイムライン
- ※詳細設計は後日決定

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 地図表示：初期読み込み3秒以内
- チェックイン操作：1秒以内にレスポンス
- 地図のスムーズなズーム・パン操作

### 3.2 可用性
- PWAとしてオフラインでも閲覧可能（直近データのキャッシュ）
- オフライン時のチェックインはキューイングし、オンライン復帰時に同期

### 3.3 セキュリティ
- OAuth 2.0によるソーシャルログイン
- APIは認証トークン必須
- 位置情報は端末上でのみ処理（サーバーに生の位置情報は送らない、駅IDのみ送信）

### 3.4 スケーラビリティ
- 初期：数十人規模
- 将来：数千人規模を想定した設計

### 3.5 ランニングコスト
- 月額500円以内に収まる構成
- 無料枠を最大限活用

---

## 4. 技術スタック

### 4.1 フロントエンド
| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js (TypeScript) |
| スタイリング | Tailwind CSS |
| 地図ライブラリ | Mapbox GL JS or Leaflet + OpenStreetMap |
| 状態管理 | Zustand or Jotai |
| PWA対応 | next-pwa |

### 4.2 バックエンド
| 項目 | 技術 |
|------|------|
| 言語 | Kotlin |
| フレームワーク | Ktor or Spring Boot |
| ORM | Exposed (Ktor) or Spring Data JPA |
| API仕様 | REST API (OpenAPI / Swagger) |

### 4.3 インフラ・データベース
| 項目 | 技術 |
|------|------|
| DB | Supabase (PostgreSQL) or PlanetScale (MySQL) |
| ストレージ | Supabase Storage or Cloudflare R2（写真用） |
| フロントホスティング | Vercel (Next.js) |
| バックエンドホスティング | Railway or Render (Kotlin) |
| 認証 | Supabase Auth or Firebase Auth |

### 4.4 コスト見積もり（月額目安）
| サービス | 費用 |
|----------|------|
| Vercel | 無料（Hobby） |
| Supabase | 無料枠 → $25/月（Pro時） |
| Railway / Render | 無料枠 → $5〜/月 |
| Mapbox | 無料枠（50,000ロード/月） |
| **合計** | **初期は無料〜数百円** |

### 4.5 技術選定の補足
- **Kotlin選定理由**：学習目的。Spring Boot / Ktorのエコシステムを活用
- **Next.js選定理由**：使い慣れたフレームワーク。PWA対応が容易
- **Supabase推奨理由**：PostgreSQL + Auth + Storage が一体で無料枠が大きい。Firebase代替として

---

## 5. 駅マスターデータ

### 5.1 データソース候補
- 国土数値情報「鉄道データ」（国土交通省、無料・商用利用可）
- 駅データ.jp（有料だが高精度）
- OpenStreetMap（無料、コミュニティ更新）

### 5.2 データ構造（概要）
```
Station {
  id: string
  name: string
  nameKana: string
  latitude: number
  longitude: number
  lines: Line[]          // 所属路線（複数可）
  prefecture: string     // "東京都"
}

Line {
  id: string
  name: string
  company: string        // "JR東日本", "東京メトロ" etc.
  color: string          // 路線カラー（#hex）
  stations: Station[]
}
```

---

## 6. 画面一覧

| 画面 | 概要 |
|------|------|
| ログイン | Google / Apple ソーシャルログイン |
| ホーム（地図） | 東京都内の地図＋駅ピン。メイン画面 |
| 駅詳細 | 訪問記録、メモ、写真、スポット一覧 |
| チェックイン | GPS / 検索 / 地図タップからのチェックイン入力 |
| スポット登録 | 駅に紐づく店舗・場所の登録 |
| 進捗ダッシュボード | 全体達成率、路線別進捗、統計グラフ |
| バッジ一覧 | 獲得済み / 未獲得バッジの表示 |
| ランダム提案 | 「次どこ行く？」機能 |
| プロフィール | ユーザー情報、設定 |
| フレンド | フレンド一覧、ランキング |

---

## 7. フェーズ分けロードマップ

### Phase 1：MVP（最小構成）— 目安 4〜6週間

**ゴール：「駅にチェックインして地図で見える」を動かす**

| タスク | 詳細 |
|--------|------|
| プロジェクトセットアップ | Next.js + Kotlin (Ktor) + Supabase の環境構築 |
| 駅マスターデータ投入 | 国土数値情報から東京都内の駅データを取得・整形・DB投入 |
| 認証 | Google ログインのみ（Apple は Phase 2） |
| 手動チェックイン | 駅名検索 → チェックイン（日時自動記録） |
| 地図表示 | 全駅ピン表示、訪問済み/未訪問の色分け |
| 駅詳細 | 訪問日時の表示 |
| 進捗表示 | 全体達成率（シンプルな数値表示） |
| PWA基本対応 | ホーム画面追加、アイコン設定 |

**この時点で得られるもの：**
- Kotlinでバックエンド開発する経験
- Next.js + 地図ライブラリの統合
- Supabaseとの連携パターン
- 自分で使える最低限のアプリ

---

### Phase 2：記録を充実させる — 目安 3〜4週間

**ゴール：「メモ・写真・スポットで思い出を残せる」**

| タスク | 詳細 |
|--------|------|
| メモ・写真投稿 | チェックイン時 or 後からメモと写真を追加 |
| スポット記録 | 駅に紐づけて居酒屋等を登録（名前・カテゴリ・評価） |
| 路線別進捗 | 路線ごとの達成率 + プログレスバー |
| Apple ログイン追加 | ソーシャルログイン拡充 |
| 地図タップチェックイン | ピンタップでのチェックイン対応 |
| 駅詳細の充実 | メモ・写真・スポットを駅詳細画面に表示 |

---

### Phase 3：ゲーミフィケーション — 目安 3〜4週間

**ゴール：「バッジとランダム提案で継続モチベーションを作る」**

| タスク | 詳細 |
|--------|------|
| バッジシステム | バッジ定義 + 条件判定ロジック + 獲得通知 |
| バッジ一覧画面 | 獲得済み / 未獲得の表示 |
| ランダム駅提案 | 未訪問駅からランダム選択、フィルタ（路線・エリア） |
| 統計ダッシュボード | 月別訪問数グラフ、ストリーク表示 |
| GPSチェックイン | 現在地取得 → 近くの駅を候補表示 → チェックイン |

---

### Phase 4：ソーシャル機能 — 目安 4〜6週間

**ゴール：「友達と競い合える、共有できる」**

| タスク | 詳細 |
|--------|------|
| フレンド機能 | 招待リンク / ID検索でフレンド追加 |
| フレンドの進捗閲覧 | フレンドの達成率・最近の訪問を表示 |
| ランキング | 総訪問数 / 月間訪問数のランキング |
| SNSシェア | 訪問記録やバッジ獲得をSNS共有用画像で投稿 |
| GPS自動通知 | 駅の近くでプッシュ通知（Service Worker） |

---

### Phase 5：パートナー機能 & 一般公開 — 将来

**ゴール：「彼女との共有マップ、一般公開」**

| タスク | 詳細 |
|--------|------|
| ペアリング機能 | パートナーとのアカウント連携 |
| 共有マップ | 2人の訪問を重ねて表示 |
| ペアバッジ | 2人で達成するバッジ |
| 一般公開対応 | パフォーマンス最適化、利用規約、不正対策 |
| ネイティブアプリ化検討 | React Native or Kotlin Multiplatform |

---

## 8. Phase 1 着手時の推奨手順

1. **Kotlinの基礎をサクッとやる**（1〜2日）
   - Ktor公式チュートリアルを写経して動かす
   - REST APIのHello Worldを立てる

2. **Supabaseのセットアップ**（半日）
   - プロジェクト作成、テーブル設計、Auth設定

3. **駅データの取得・整形**（1日）
   - 国土数値情報からデータをダウンロード
   - スクリプトでパースしてSupabaseに投入

4. **Kotlin APIサーバー構築**（1〜2週間）
   - 駅一覧API、チェックインAPI、進捗API
   - Supabase PostgreSQLとの接続

5. **Next.jsフロントエンド構築**（1〜2週間）
   - Google認証、地図表示、チェックイン画面

6. **デプロイ & 動作確認**（数日）
   - Vercel + Railway にデプロイ
   - 実際にスマホで使ってみる

---

## 9. 備考・検討事項

- 駅の統廃合や新駅開業への対応方針は後日検討
- 乗換駅（例：渋谷）の扱い：路線ごとに別カウント or 1駅扱いの選択
- 将来のネイティブアプリ化を見据え、APIはRESTで汎用的に設計する
- オフライン対応の深さはPWAの制約次第で段階的に判断
